{% extends 'base.html.twig' %}

{% block body %}
	{% form_theme form 'bootstrap_5_layout.html.twig' %}

	<div class="container py-5">
		<div class="row justify-content-center">
			<div class="col-12 col-lg-8 col-xl-7">
				<h1 class="text-center mb-4 text-dark">Cr√©er un pointage</h1>

				{{ form_start(form, {
                    attr: {
                        class: 'bg-white p-4 p-md-5 rounded-3 shadow-sm'
                    }
                }) }}

				<div class="mb-3">
					{{ form_row(form.clockingUser) }}
				</div>

				<div class="mb-4">
					{{ form_row(form.date) }}
				</div>

				<h3 class="h5 mb-3 text-secondary">Chantiers</h3>

				<div id="entries-wrapper" class="d-flex flex-column" data-prototype="{{ form_widget(form.entries.vars.prototype)|e('html_attr') }}">
					{% for entryForm in form.entries %}
						<div class="entry-item bg-light border rounded-3 p-3 mb-3">
							<div class="mb-3">
								{{ form_row(entryForm.project) }}
							</div>
							<div>
								{{ form_row(entryForm.duration) }}
							</div>
						</div>
					{% endfor %}
				</div>

				<button type="button" id="add-entry" class="btn btn-outline-secondary mb-3">
					+ Ajouter un chantier
				</button>

				{{ form_row(form.submit, {
                    attr: { class: 'btn btn-dark mt-2' }
                }) }}

				{{ form_end(form) }}
			</div>
		</div>
	</div>
{% endblock %}

{% block javascripts %}
	{{ parent() }}
	<script>
		document.addEventListener('DOMContentLoaded', () => {
const wrapper = document.getElementById('entries-wrapper');
const addButton = document.getElementById('add-entry');
let index = {{ form.entries|length }};

addButton.addEventListener('click', () => {
const prototype = wrapper.dataset.prototype;
const newFormHtml = prototype.replace(/__name__/g, index);

const entryDiv = document.createElement('div');
entryDiv.className = 'entry-item bg-light border rounded-3 p-3 mb-3';
entryDiv.innerHTML = `
                    <div class="row g-3">
                        ${newFormHtml}
                    </div>
                `;

wrapper.appendChild(entryDiv);
index++;
});
});
	</script>
{% endblock %}
